<%= render 'shared/admin-navbar' %>

<h1>Select items</h1>


<div class="container m-3">


  <div class="d-flex flex-column bd-highlight my-2">

      <div class="my-3 d-flex">
        <%= form_tag(items_path, :method => "get", class:"form-inline") do %>
          <%= text_field_tag :query, params[:query], class: 'form-control' %>
           <%= collection_select :food_id, :id, Food.all.order(:name), :id, :name, :include_blank => true, class: 'form-control' %>
           <%= f.collection_select(:category_id, Category.arrange_as_array, :id, :name_for_selects, {:include_blank => true}, {:class => 'form-control form-control-lg select'}) %>
          <%= submit_tag "Search", class: 'form-control  btn-primary' %>
        <% end %>
      </div>

      <div class="d-flex">
        <div class="dropdown">
          <button class="bd-highlight mr-1 btn bg-light border dropdown-toggle" type="button" id="dropdownSortButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <%= @food.present? ? @food.name : "Food" %>
          </button>
          <div class="dropdown-menu dropdown-menu-left" aria-labelledby="dropdownSortButton">
            <%= link_to "ALL FOOD", foods_path, class:"dropdown-item" %>
            <% Food.all.order(:name).each do |food| %>
            <%= link_to food.name, items_path(food_id: food.id), class:"dropdown-item" %>
            <% end %>
          </div>
          <div class="dropdown-menu dropdown-menu-left" aria-labelledby="dropdownSortButton">
            <%= link_to "CATEGORIES", categories_path, class:"dropdown-item" %>
            <% Category.all.order(:name).each do |category| %>
            <%= link_to category.name, items_path(category_id: category.id), class:"dropdown-item" %>
            <% end %>
          </div>
        </div>
        <button class="btn border"><%= link_to "Unlabeled", items_path(is_labeled: 0) %></button>
      </div>

  </div>


  <div>
    <div class="d-flex">
      <p class="m-2"><%= @results.size if @results %> results</p>
      <p class="m-2"><%= @results.distinct.count('name') if @results %> uniques</p>
    </div>

    <% if @results %>

      <%= form_tag(edit_multiple_items_path, :method => "get") do %>
        <%= submit_tag "Update all"%>
        <% @results.order(:id).reverse.uniq(&:name).each do |item| %>

           <div class="pl-2 pr-2 p-0 list-group-item list-group-item-action border-bottom d-flex flex-column justify-content-start">
             <%= hidden_field_tag "item_ids[]", item.id  %>
                <div class="product-info p-2">
                  <div class="product-description text-dark">
                    <div class="d-flex justify-content-between">
                      <h5 class="mb-1 text-primary"><%= link_to item.name, edit_item_path(item) %></h5>
                      <div class="d-flex flex-column align-items-end">
                        <p class="text-primary m-0"><%= item.categroy.present? ? item.category.name : "no match" %></p>
                        <small class="text-muted m-0"><%= item.get_store_section.name if item.get_store_section.present? %></small>
                      </div>
                    </div>
                  </div>
                </div>
           </div>

        <% end %>
      <% end %>

    <% end %>

  </div>
</div>


