updateSavedItems();
insert();
refreshForm();
updateScore();

function updateSavedItems() {
  var listItemCards = document.querySelectorAll("#grocerylist-item-id<%= @saved_item.id %>");
  listItemCards.forEach(n => n.remove());
}

function insert() {
  const section = document.getElementById("<%= @headername %>")
  const sectionElements = document.getElementById("<%= @headername %>Elements");
  var newData = Number(section.getAttribute('data')) + 1;
  $(section).attr('data', newData);
  sectionElements.insertAdjacentHTML("beforeEnd", "<%= j render 'items/show', list: @list, item: @item %>");
  sortSectionElements(sectionElements);
}

function sortSectionElements(sectionElements) {
  const listItems = sectionElements.querySelectorAll(".listItemShow")
  const sortedListItems = $(listItems).sort((a,b)=>a.innerText.toLowerCase()>b.innerText.toLowerCase()?1:-1)
  const sortedSectionElements = $(sortedListItems).map(function() {
    sectionElements.appendChild(this);
  })
}


// update list score
function updateScore() {
  if(document.querySelector("#score")){
    var listId = document.querySelector("#score").getAttribute('data');

    $.ajax({
      url: "/get_score",
      cache: false,
      data: {
        l: listId
      },
      success: function(){
      }
    });
  }
}

function refreshForm() {
  const newListItemForm = document.getElementById('newListItem');
  newListItemForm.value = '';
  var submitButton = document.getElementById('addListItemBtn');
  $(submitButton).prop('disabled', true);
  event.preventDefault();
}
