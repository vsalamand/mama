<div class="container mb-4">
  <%= link_to "Retour vers la liste de courses", list_path(@list), class: "mt-3 btn btn-outline-secondary btn-block"  %>
</div>


<div class="container">
  <div class="shadow p-3 mb-2 bg-white rounded d-flex align-items-center justify-content-between">
    <div>
      <h4 class="pl-0 pr-0 mb-0" id="title">Panier</h4>
      <p class="mb-0 font-weight-light">Leclerc</p>
      <small class="mb-0 font-weight-light">Sélection:</small>
      <span class="badge badge-primary font-weight-light">premiers prix</span>
    </div>
    <div>
      <h2 class="pl-0 pr-0 mb-0"><%= @cart.get_total_price %>€</h2>
    </div>
  </div>
</div>

<div class="container pl-3 p-1 mb-2">
  <div class="d-flex align-items-center">
  <!-- Button trigger modal -->
    <button type="button" class="btn btn-sm btn-success p-2 m-1" data-toggle="modal" data-target="#shareModal">
      Envoyer par email
    </button>
    <% if current_user.present? && current_user.admin == true %>
      <button type="button" class="btn btn-sm btn-warning p-2 m-1" data-toggle="modal" data-target="#adminShareModal">
        Magic share
      </button>
    <% end %>
  </div>

  <!-- Modal -->
    <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="shareModalLabel">Envoyer par email</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <%= form_tag(cart_share_path(@cart), class: 'form-group') do |f| %>
            <div class="modal-body">
              <%= text_field_tag 'email', '', value: "#{current_user.present? ? current_user.email : ''}", type: "email", class:"form-control" %>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Annuler</button>
              <%= submit_tag "submit",:value => "Envoyer", class:"btn btn-primary"%>
            </div>
          <% end %>
        </div>
      </div>
    </div>

  <!-- Admin Modal -->
    <div class="modal fade" id="adminShareModal" tabindex="-1" role="dialog" aria-labelledby="adminShareModal" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="adminShareModal">Envoyer par email</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <%= form_tag(cart_special_share_path(@cart), class: 'form-group') do |f| %>
            <div class="modal-body">
              <%= text_field_tag 'email', '', value: "#{current_user.present? ? current_user.email : ''}", type: "email", class:"form-control" %>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Annuler</button>
              <%= submit_tag "submit",:value => "Envoyer", class:"btn btn-primary"%>
            </div>
          <% end %>
        </div>
      </div>
    </div>

</div>

<div class="container">
  <% if @cart.cart_items.any? %>
    <div class="shadow p-0 mb-2 bg-white rounded">
      <div class="list-group list-group-flush mb-2">
        <% @cart.cart_items.where.not(productable_id: nil).order(:item_id).each do |cart_item| %>
          <%= render 'product-card', product_item: StoreItem.find(cart_item.productable_id), cart_item: cart_item, item: cart_item.item %>
        <% end %>
      </div>
    </div>
    <div class="shadow p-0 mb-2 bg-white rounded">
      <div class="list-group list-group-flush">
        <% @cart.cart_items.where(productable_id: [nil, ""]).order(:item_id).each do |cart_item| %>
          <%= render 'no-product-card', cart_item: cart_item, item: cart_item.item %>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="shadow p-0 mb-2 bg-white rounded">
      <a class="list-group-item list-group-item-action">
        <p class="mb-1">Le panier est vide.</p>
      </a>
    </div>
  <% end %>
</div>

<% if @unavailable.any? %>
  <div class="container">
    <div class="shadow p-3 mb-5 bg-white rounded">
      <small class="mb-0 font-weight-light">Pas de résultat pour:</small>
      <div>
        <% @unavailable.each do |toto| %>
          <p class="mb-0 font-weight-light"><%= toto.name  %></p>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

